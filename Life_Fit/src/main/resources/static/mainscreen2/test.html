<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>ğŸ“ ë¶€ì‚° ì§€ì—­ ì¹˜ì•ˆì‹œì„¤ ëª©ë¡</title>
	<style>
		body {
			font-family: Arial, sans-serif;
		}
		h2 {
			margin-top: 20px;
		}
		.status {
			margin: 10px 0;
			font-weight: bold;
			color: #007bff;
		}
		table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 10px;
		}
		th, td {
			border: 1px solid #aaa;
			padding: 8px;
			text-align: left;
		}
		th {
			background-color: #f0f0f0;
		}
	</style>
</head>
<body>

<h2>ğŸ“ ë¶€ì‚° ì§€ì—­ ì¹˜ì•ˆì‹œì„¤ ëª©ë¡</h2>
<div class="status" id="status">ë°ì´í„° ë¡œë”© ì¤‘...</div>

<table id="facilityTable" style="display: none;">
	<thead>
	<tr>
		<th>ê²½ì°°ì²­</th>
		<th>ê²½ì°°ì„œ</th>
		<th>ì‹œì„¤ëª…</th>
		<th>ë„ë¡œëª…ì£¼ì†Œ</th>
	</tr>
	</thead>
	<tbody></tbody>
</table>

<script>
	const serviceKey = 'M8WULWL5-M8WU-M8WU-M8WU-M8WULWL54M';  // ğŸ‘‰ ë³¸ì¸ì˜ ì„œë¹„ìŠ¤í‚¤ ì‚¬ìš©
	const table = document.getElementById("facilityTable");
	const tbody = table.querySelector("tbody");
	const status = document.getElementById("status");

	async function fetchXmlPage(pageNo) {
		const url = `https://safemap.go.kr/openApiService/data/getSecurityFacilityData.do?serviceKey=${serviceKey}&pageNo=${pageNo}&numOfRows=100&type=xml`;
		const res = await fetch(url);
		const text = await res.text();
		return new window.DOMParser().parseFromString(text, "application/xml");
	}

	function getValue(item, tag) {
		const el = item.getElementsByTagName(tag)[0];
		return el ? el.textContent.trim() : '-';
	}

	async function loadAllData() {
		let page = 1;
		let totalLoaded = 0;
		while (true) {
			const xml = await fetchXmlPage(page);
			const items = xml.getElementsByTagName("item");
			if (items.length === 0) break;

			for (let item of items) {
				const police = getValue(item, "POLICE");
				const polcsttn = getValue(item, "POLCSTTN") || '-';
				const fcltyNm = getValue(item, "FCLTY_NM");
				const addr = getValue(item, "RN_ADRES");

				// ë¶€ì‚° ì§€ì—­ë§Œ ì¶œë ¥
				if (police.includes("ë¶€ì‚°")) {
					const row = document.createElement("tr");
					[police, polcsttn, fcltyNm, addr].forEach(value => {
						const td = document.createElement("td");
						td.textContent = value;
						row.appendChild(td);
					});
					tbody.appendChild(row);
					totalLoaded++;
				}
			}
			page++;
		}

		table.style.display = "table";
		status.textContent = `âœ… ì´ ${page - 1} í˜ì´ì§€ ì™„ë£Œ. ë¶€ì‚° ì§€ì—­ ì¹˜ì•ˆì‹œì„¤ ì •ë³´ ë¡œë“œë¨.`;
	}

	loadAllData().catch(err => {
		console.error("âŒ ì˜¤ë¥˜ ë°œìƒ:", err);
		status.textContent = "âŒ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨ (CORS ë˜ëŠ” ì¸ì¦í‚¤ ë¬¸ì œì¼ ìˆ˜ ìˆìŒ)";
	});
</script>

</body>
</html>